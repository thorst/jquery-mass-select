<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.js"></script>
    <!-- Respond.js proxy on external server -->
    <link href="//netdna.bootstrapcdn.com/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
    <link href="respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
    <script src="respond.proxy.js"></script>
    <script>
        if (!window.console) console = {};
        if (!window.console.time) { console.time = function () { }; console.timeEnd = function () { }; }
        $log = {
            i: [],
            s: function (title) {
                console.time(title);
                $log.i[title] = new Date().getTime();
            },
            e: function (title) {
                var end = new Date().getTime();
                console.timeEnd(title);
                var time = end - $log.i[title];
                $("#log").append(title + ': ' + time + "ms\r");
                delete $log.i[title];
            }
        };
        $p = {
            select: [],
            ul: null,
            render: 1000,
            i: 0,
            showing: 0,
            createObject: function (d) {
                $log.s('Create data');
                for (var i = 0; i < d; i++) {
                    $p.select.push({ name: 'Value #' + i, value: i.toString(), type: "option", isoption: true, ischecked: false, isvisible: true });
                };
                $log.e('Create data');
            },
            createOptions: function () {
                $log.s('Render plugin');
                //21
                var lis = [], total = $p.i + $p.render;

                while (lis.length < $p.render) {
                    //abort if we've gone to far
                    if ($p.i > $p.select.length - 1) {
                        break;
                    }
                    var e = $p.select[$p.i];
                    if (e.isvisible) {
                        lis.push($p.createOptionValue(e));
                    }

                    $p.i++
                }
                $p.i = total;
                $p.showing = lis.length;
                $p.ul.html(lis.join(""));
                $log.e('Render plugin');
            },
            createOptionValue: function (e) {
                var s = e.ischecked ? "class='active'" : ""
                return "<li "+s+"><a href='javascript:;'>" + e.name + '</a></li>';
            },
            togglePaging: function () {
                $("#next").toggleClass("disabled", $p.i > $p.select.length || $p.showing < $p.render);
                $("#prev").toggleClass("disabled", $p.i == $p.render);
            },
            searchTerm: "",
            searchA: {
                type1a: function () {
                    $log.s('Search');

                    for (var i = 0; i < $p.select.length; i++) {
                        var e = $p.select[i],
                            match = e.value.indexOf($p.searchTerm) == -1;
                        if (e.isvisible && match) {
                            e.isvisible = false;
                            continue;
                        } else if (!e.isvisible && !match) {
                            e.isvisible = true;
                            continue;
                        }
                    }
                    $log.e('Search');
                }


            }

        };
        $(document).ready(function () {
            $p.ul = $("#multiselect-ul");
            $p.createObject(9085);
            $p.createOptions();

            $("#searchText").on("keyup", function () {
                $p.searchTerm = this.value;
                $p.i = 0;
                $p.searchA.type1a();
                $p.createOptions();
                $p.togglePaging();
            });

            $("#testBtn").click(function () {
                $("#innerWrap").css("margin-top", $("#innerWrap").css("margin-top") == "-100000px" ? "0" : "-100000px")
            });

            $("#next").click(function () {
                $p.createOptions();
                $p.togglePaging();
            });
            $("#prev").click(function () {
                $p.i -= ($p.render * 2);
                $p.createOptions();
                $p.togglePaging();
            });
            $p.ul.on("click", "li", function () {
                var o = $(this);
                o.addClass("active");
                var x = $p.select[o.prevAll().length];
                x.ischecked = !x.ischecked;
            });
            $("#btSelected").click(function () {
                $log.s('getVals');
                var vals = [];
                $.each($p.select, function (idx, e) { if (e.ischecked) { vals.push(e.value); } });
                $log.e('getVals');
                console.log(vals);
            });
            $("#checkAll").click(function () {
                var shouldCheck = $(this).text() == "Check all";
                $p.ul.find("li").toggleClass("active", shouldCheck);
                for (var i = 0; i < $p.select.length; i++) {
                    $p.select[i].ischecked = shouldCheck;
                }
                $(this).text(shouldCheck ? "Uncheck all" : "Check all");
            });
            $("#showSelected").click(function () {
                for (var i = 0; i < $p.select.length; i++) {
                    $p.select[i].isvisible = $p.select[i].ischecked;
                }
                $p.createOptions();
            });
        });
    </script>
    <style>
        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
        }

            li > a {
                display: block;
                color: #333;
                white-space: nowrap;
                padding: 3px 20px;
            }

                li > a:hover, li > a:focus {
                    background-color: #f5f5f5;
                    color: #262626;
                    text-decoration: none;
                }

            li.active > a {
                background-color: #428BCA;
                color: #FFFFFF;
                outline: 0 none;
            }
    </style>
</head>
<body>
    <div class="container" style="margin-top:20px;">
        <p>
            This drop down has 10,000 elements
            HAS
            <ul>
                <li>Paging</li>
                <li>Filtering</li>
            </ul>
            NEEDS
            <ul>
                <li>separators</li>
                <li>opt groups</li>
                <li>show dropdown actions</li>
            </ul>
        </p>
        <div class="btn-group btn-group-justified">
            <a id="testBtn" href="#" class="btn btn-large btn-default">Show</a>
            <a id="btSelected" href="#" class="btn btn-large btn-default">Get Selected</a>
        </div>
        <div id="outerWrap" style="overflow: hidden; ">
            <div id="innerWrap" style="margin-top: -100000px; ">
                <div class="input-group">
                    <span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>
                    <input type="text" class="form-control" id="searchText">
                    <div class="input-group-btn">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Show <span class="caret"></span></button>
                        <ul class="dropdown-menu pull-right">
                            <li><a href="#" id="showAll">All</a></li>
                            <li><a href="#" id="showSelected">Selected</a></li>
                            <li><a href="#" id="showUnselected">Unselected</a></li>
                        </ul>
                    </div>
                </div>
                <div class="btn-group btn-group-justified">
                    <a href="#" id="prev" class="btn btn-default disabled"><</a>
                    <a href="#" id="checkAll" class="btn btn-default">Check all</a>
                    <a href="#" id="next" class="btn btn-default ">></a>
                </div>
                <ul id="multiselect-ul"></ul>

            </div>
        </div>


    </div>
</body>
</html>
